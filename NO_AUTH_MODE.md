# Database-Only Mode (No Supabase Auth)

## Overview
The application now uses **database-only authentication** instead of Supabase Auth. All user authentication is handled by checking passwords stored directly in the `users` table.

## What Changed

### 1. **Admin Login** (`src/app/admin/page.tsx`)
- **Before**: Used `supabase.auth.signInWithPassword()` to authenticate
- **Now**: Checks email and password directly from the `users` table
- **How it works**:
  1. User enters email and password
  2. System queries `users` table for matching email
  3. Compares provided password with stored password
  4. Verifies `is_admin = true`
  5. Stores email in `localStorage` for session management

### 2. **User Creation** (`src/app/admin/page.tsx`)
- **Before**: Created user in Supabase Auth first, then in `users` table
- **Now**: Generates UUID using `crypto.randomUUID()` and stores directly in `users` table
- **No more**:
  - Rate limits from Supabase Auth
  - Email confirmation requirements
  - Temporary email generation for Auth
  - Auth signup/signin calls

### 3. **User Signup** (`src/app/profile/page.tsx`)
- **Before**: Created user in Supabase Auth, then in `users` table
- **Now**: Generates UUID and stores directly in `users` table
- **Simplified**: No Auth calls, no email requirements

### 4. **User Login** (`src/app/profile/page.tsx`)
- **Before**: Used `supabase.auth.signInWithPassword()` after verifying password
- **Now**: Only checks password from `users` table
- **Stores**: User data in `localStorage` for session management

### 5. **My Products Page** (`src/app/my-products/page.tsx`)
- **Before**: Checked Supabase Auth session first
- **Now**: Uses `localStorage` to get user ID directly

### 6. **Image Upload** (`src/app/admin/page.tsx`)
- **Before**: Checked Supabase Auth session before upload
- **Now**: Checks `localStorage` for admin email

## Database Schema

The `users` table structure remains the same:
```sql
CREATE TABLE users (
    id UUID PRIMARY KEY,
    name TEXT NOT NULL,
    phone TEXT NOT NULL,
    email TEXT,  -- Optional, can be NULL
    password TEXT NOT NULL,  -- Stored in plain text (for simplicity)
    is_admin BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP DEFAULT NOW()
);
```

## Session Management

- **Admin sessions**: Stored in `localStorage` as `adminEmail`
- **User sessions**: Stored in `localStorage` as:
  - `userId`
  - `userName`
  - `userPhone`

## Security Considerations

⚠️ **Important Notes**:
1. **Passwords are stored in plain text** in the database
2. For production, consider:
   - Hashing passwords (bcrypt, argon2, etc.)
   - Using HTTPS for all connections
   - Implementing proper session tokens
   - Adding rate limiting at application level

## Benefits

✅ **No rate limits** - No Supabase Auth rate limits to worry about
✅ **No email requirements** - Users can be created without emails
✅ **Simpler flow** - Direct database operations
✅ **Faster** - No Auth API calls
✅ **More control** - Full control over authentication logic

## Migration Notes

If you have existing users created with Supabase Auth:
1. Their `id` values are UUIDs from `auth.users`
2. These will continue to work as long as they exist in the `users` table
3. New users will have UUIDs generated by `crypto.randomUUID()`
4. No migration needed - both UUID formats work the same

## Testing

To test the new authentication:
1. **Admin Login**: Go to `/admin` and login with email/password from `users` table
2. **User Signup**: Go to `/profile`, enter phone number, create account
3. **User Login**: Go to `/profile`, enter phone number and password
4. **My Products**: Should work with `localStorage` user data

## Troubleshooting

If authentication doesn't work:
1. Check that user exists in `users` table
2. Verify password matches exactly (case-sensitive)
3. Check browser console for errors
4. Verify `localStorage` has the correct values
5. Ensure Supabase database connection is working










